#!/bin/sh
set -e

# Убираем prebuild (чтобы tsc не завалил сборку)
jq 'del(.scripts.prebuild)' packages/mcp-server-supabase/package.json > tmp.$$.json \
  && mv tmp.$$.json packages/mcp-server-supabase/package.json

# Собираем утилиты (если есть)
pnpm --filter @supabase/mcp-utils exec tsup --dts --format esm,cjs --clean --sourcemap --entry src/index.ts || true

# Собираем сам сервер
pnpm --filter @supabase/mcp-server-supabase exec tsup --clean
